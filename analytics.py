import os
import re

#os.chdir('python')

import sqlite3

connection = sqlite3.connect('database/threats.db')

cursor = connection.cursor()

query = 'SELECT * FROM threats_table'

cursor.execute(query)

data = cursor.fetchall()

countries = []
threats = []
ip = []


for row in data:
	if row[0] != '-':           ##### ip plot
		ip.append(row[0])   #####
	if row[2] != '-':
		if not (bool(re.match('^[A-Z0-9]+$', row[2]))):   ####  threats type plot
			threats.append(row[2])                    ####
	if row[5] != '-':
		countries.append(row[5]) #### countries plot

import matplotlib.pyplot as plt

from collections import Counter


##############################################  countries start #####################################
countries = Counter(countries)

plt.pie([int(v) for v in countries.values()])
plt.legend([str(k) for k in countries], loc='upper left', prop={'size': 8}, ncol=2)
plt.show() #plt.savefig(....)

############################################## countries end #########################################


############################################# threats start  #########################################
threats = Counter(threats)
threats_top = threats.most_common(10)

q = []
k = []
for duo in threats_top:
	q.append(duo[0])
	k.append(duo[1])

plt.pie(k, autopct='%1.1f%%')
plt.legend(q, loc='upper left', prop={'size': 8}, ncol=1)
plt.show()
############################################# threats end  ############################################

#############################################  ip start    ############################################
ips = Counter(ip)
ips_top = ips.most_common(10)
a = []
b = []
for duo in ips_top:
	a.append(duo[0])
	b.append(duo[1])
plt.bar(a, b)
plt.show()

############################################  ip end  ################################################
